<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#062e3f">
    <meta name="Description" content="A dynamic and aesthetic To-Do List WebApp.">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Google Font: Quick Sand -->
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300&display=swap" rel="stylesheet">

    <!-- font awesome (https://fontawesome.com) for basic icons; source: https://cdnjs.com/libraries/font-awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-2/css/all.min.css"
          integrity="sha256-46r060N2LrChLLb5zowXQ72/iKKNiw/lAmygmHExk/o=" crossorigin="anonymous"/>

    <link rel="shortcut icon" type="image/png" href="assets/favicon.png"/>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/corner.css" th:href="@{/css/corner.css}">
    <title>Registration</title>
    <script th:src="@{/js/pwstrength.js}"></script>
</head>
<body>
<div style="align-self: flex-end; padding-right: 10px"><a href="/swagger-ui.html" class="btn">Api Documentation</a>
</div>

<header id="header">

    <h1>ToDo List</h1>
</header>

<div class="version">
    <div class="demo version-section"><a href="https://github.com/Andrej5768/todo" class="github-corner">
        <svg width="80" height="80" viewBox="0 0 250 250"
             style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
                  fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
                  fill="currentColor" class="octo-body"></path>
        </svg>
    </a>
    </div>

    <div class="container" style="max-height: fit-content">
        <div class="login-container-wrapper clearfix">
            <div class="welcome"><strong>Registration</strong></div>
            <form action="/" method="POST" enctype="utf8" class="form-horizontal register-form">
                <div class="form-group relative">
                    <label for="firstName">First Name</label>
                    <input id="firstName" class="form-control rounded-3" placeholder="John" name="firstName"
                           value=""
                           required="required">
                    <span id="firstNameError" class="alert alert-danger col-sm-4" style="display:none"></span>
                </div>

                <div class="form-floating mb-3">
                    <label for="lastName" class="col-sm-3">Last Name</label>
                    <input id="lastName" class="form-control rounded-3" placeholder="Doe" name="lastName" value=""
                           required="required">
                    <span id="lastNameError" class="alert alert-danger col-sm-4" style="display:none"></span>
                </div>

                <div class="form-floating mb-3">
                    <label for="email" class="col-sm-3">Email</label>
                    <input id="email" type="email" class="form-control rounded-3" placeholder="example@mail.com"
                           name="email" value=""
                           required="required">
                    <span id="emailError" class="alert alert-danger col-sm-4" style="display:none"></span>
                </div>
<!--                <div class="form-group relative password">-->
<!--                    <label for="password" class="col-sm-3">Password</label><br>-->
<!--                    <div style="display: flex; justify-content: space-between">-->
<!--                        <input id="password" type="password" class="form-control rounded-3"-->
<!--                               placeholder="qwerty"-->
<!--                               name="password" value="" required="required" autocomplete="new-password">-->

<!--                        <span class="fa fa-fw fa-eye field-icon toggle-password"-->
<!--                              style="margin-left: -30px; cursor: pointer; align-self: center"-->
<!--                              onclick="togglePassword('password'); togglePassword('matchPassword')"></span>-->
<!--                    </div>-->

<!--                    <span id="passwordError" class="alert alert-danger col-sm-4" style="display:none"></span>-->

<!--                </div>-->
                <div class="form-group relative password">
                    <label for="password" class="col-sm-3">Password</label>
                    <span class="fa fa-fw fa-eye field-icon toggle-password"
                          style="cursor: pointer; margin-left: 10px;"
                          onclick="togglePassword('password'); togglePassword('matchPassword')"></span>
                    <div>
                        <input id="password" type="password" class="form-control rounded-3"
                               placeholder="qwerty"
                               name="password" value="" required="required" autocomplete="new-password">


                    </div>

                    <div style="margin-left: 70px;">
                        <span id="passwordError" class="alert alert-danger" style="display: none;"></span>
                    </div>
                </div>
                <br/>
                <div class="form-group relative password">
                    <label for="matchPassword" class="col-sm-3">Confirm Password</label>
                    <input id="matchPassword" type="password" class="form-control rounded-3" placeholder="qwerty"
                           name="matchingPassword" value=""
                           required="required" autocomplete="new-password">

                    <span id="globalError" class="alert alert-danger col-sm-4" style="display:none"></span>
                </div>
                <div id="passwordMismatch" style="color: red;" th:if="${messages != null}" th:text="${messages}"></div>
                <!--                <div >-->
                <button type="submit" class="btn" id="registerButton">Register</button>
                <!--                </div>-->
                <!--                <div class="checkbox pull-right">-->
                <!--                    <label> <a class="forget" href="" title="forget">Forgot your password</a> </label>-->
                <!--                </div>-->
                <div class="link">
                    <p>Have an account? <a href="/login">Login</a></p>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    function togglePassword(inputId) {
        const passwordInput = document.getElementById(inputId);
        if (passwordInput.type === "password") {
            passwordInput.type = "text";
        } else {
            passwordInput.type = "password";
        }
    }
</script>
<script th:inline="javascript">
    var serverContext = [[@{/}]];

        $(document).ready(function () {
            $('form').submit(function (event) {
                showLoader();
                register(event);
            });

            $(":password").keyup(function () {
                if ($("#password").val() != $("#matchPassword").val()) {
                    $("#globalError").show().html([[#{PasswordMatches.user}]]);
                } else {
                    $("#globalError").html("").hide();
                }
            });

            options = {
                common: {minChar: 8},
                ui: {
                    showVerdictsInsideProgressBar: true,
                    showErrors: true,
                    errorMessages: {
                        wordLength: [[#{error.wordLength}]],
                        wordNotEmail: [[#{error.wordNotEmail}]],
                        // wordSequences: /*[[#{error.wordSequences}]]*/,
                        // wordLowercase: /*[[#{error.wordLowercase}]]*/,
                        // wordUppercase: /*[[#{error.wordUppercase}]]*/,
                        wordOneNumber: [[#{error.wordOneNumber}]]
                        // wordOneSpecialChar: /*[[#{error.wordOneSpecialChar}]]*/
                    }
                }
            };
            $('#password').pwstrength(options);
        });

    function register(event) {
        event.preventDefault();
        $(".alert").html("").hide();
        $(".error-list").html("");
        if ($("#password").val() != $("#matchPassword").val()) {
            $("#globalError").show().html(/*[[#{PasswordMatches.user}]]*/);
            return;
        }
        var formData = $('form').serialize();
        $.post(serverContext + "api/user/registration", formData, function (data) {
            if (data.message == "success") {
                window.location.href = serverContext + "successRegister";
            }

        })
            .fail(function (data) {
                if (data.responseJSON.error.indexOf("MailError") > -1) {
                    window.location.href = serverContext + "emailError";
                } else if (data.responseJSON.error == "UserAlreadyExist") {
                    $("#emailError").show().html(data.responseJSON.message);
                } else if (data.responseJSON.error.indexOf("InternalError") > -1) {
                    window.location.href = serverContext + "login?message=" + data.responseJSON.message;
                } else {
                    var errors = $.parseJSON(data.responseJSON.message);
                    $.each(errors, function (index, item) {
                        if (item.field) {
                            $("#" + item.field + "Error").show().append(item.defaultMessage + "<br/>");
                        } else {
                            $("#globalError").show().append(item.defaultMessage + "<br/>");
                        }

                    });
                }
                hideLoader();
            });
    }

    function showLoader() {
        var button = document.getElementById("registerButton");

        var loader = document.createElement("div");
        loader.className = "loader";

        button.innerHTML = "";
        button.appendChild(loader);

        button.disabled = true;
    }

    function hideLoader() {
        var button = document.getElementById("registerButton");
        button.innerHTML = "Register";
        button.disabled = false;
    }

</script>
</body>
</html>
